<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FantaTennis</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#1a472a 0%,#0f2818 50%,#1a472a 100%);
  min-height:100vh;
  padding:20px;
}
.container{max-width:1400px;margin:0 auto}
.header{text-align:center;margin-bottom:25px}
.title{
  font-size:2.5em;
  font-weight:900;
  background:linear-gradient(135deg,#FFD700,#FFA500);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-transform:uppercase;
}

.table-wrapper{
  background:rgba(255,255,255,.95);
  border-radius:15px;
  padding:20px;
  margin-bottom:20px;
}

table{width:100%;border-collapse:collapse;font-size:.9em}
th,td{padding:6px 10px;text-align:center;border-bottom:1px solid #eee}
th{
  background:linear-gradient(135deg,#1a472a,#2d6b4a);
  color:white;
  font-weight:bold;
}

.player-avatar{
  width:45px;height:45px;
  border-radius:50%;
  margin:auto;
  overflow:hidden;
  border:2px solid white;
}
.player-avatar img{width:100%;height:100%;object-fit:cover}
.player-name{font-size:.75em;color:white;font-weight:600}

input{
  width:100%;
  padding:6px;
  border-radius:5px;
  border:1px solid #ccc;
  text-align:center;
  font-weight:bold;
}

.total-row{
  background:linear-gradient(135deg,#1a472a,#2d6b4a);
  color:white;
  font-weight:bold;
}

.controls{
  display:flex;
  gap:12px;
  justify-content:center;
  flex-wrap:wrap;
  margin-top:20px;
}

.btn{
  padding:10px 20px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}
.btn-primary{background:#f39c12;color:white}
.btn-success{background:#27ae60;color:white}
.btn-danger{background:#e74c3c;color:white}

/* MONTEPREMI */
.prize-table th,.prize-table td{color:white;font-weight:bold}

/* STATISTICHE */
.stats-wrapper{
  background:linear-gradient(135deg,#1a472a,#2d6b4a);
  border-radius:15px;
  padding:10px;
  margin-bottom:20px;
}
.stats-wrapper th,.stats-wrapper td{
  color:white;
  padding:4px 6px;
  font-size:.85em;
}
.stats-player{
  cursor:pointer;
  text-decoration:underline;
}
.stats-player:hover{color:#FFD700}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
}
.modal-content{
  background:white;
  margin:15% auto;
  padding:20px;
  max-width:400px;
  border-radius:12px;
}
.modal-header{
  font-size:1.3em;
  font-weight:bold;
  margin-bottom:10px;
  color:#1a472a;
}
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <h1 class="title">‚ö° FantaTennis 2026</h1>
  </div>

  <!-- MONTEPREMI -->
  <table class="prize-table table-wrapper">
    <thead>
      <tr><th>TORNEO</th><th>ü•á</th><th>ü•à</th><th>ü•â</th></tr>
    </thead>
    <tbody>
      <tr><td>ATP 500</td><td>6 ‚Ç¨</td><td>4 ‚Ç¨</td><td>2 ‚Ç¨</td></tr>
      <tr><td>ATP 1000</td><td>10 ‚Ç¨</td><td>5 ‚Ç¨</td><td>3 ‚Ç¨</td></tr>
      <tr><td>SLAM</td><td>14 ‚Ç¨</td><td>8 ‚Ç¨</td><td>5 ‚Ç¨</td></tr>
      <tr><td>FINALS</td><td>20 ‚Ç¨</td><td>10 ‚Ç¨</td><td>8 ‚Ç¨</td></tr>
    </tbody>
  </table>

  <!-- TORNEI -->
  <div class="table-wrapper">
    <table id="fantatable">
      <thead id="tablehead"></thead>
      <tbody id="tablebody"></tbody>
    </table>
  </div>

  <!-- STATISTICHE -->
  <div class="stats-wrapper">
    <table>
      <thead>
        <tr><th>Giocatore</th><th>ü•á</th><th>ü•à</th><th>ü•â</th></tr>
      </thead>
      <tbody id="statsbody"></tbody>
    </table>
  </div>

  <!-- CONTROLLI -->
  <div class="controls">
    <button class="btn btn-primary" onclick="openModal()">+ Torneo</button>
    <button class="btn btn-success" onclick="saveData()">üíæ Salva</button>
    <button class="btn btn-danger" onclick="resetData()">üîÑ Reset</button>
  </div>
</div>

<!-- MODAL TORNEO -->
<div id="modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">Nuovo torneo</div>
    <input id="tournamentname" placeholder="Nome torneo" style="width:100%;padding:8px">
    <br><br>
    <button class="btn btn-primary" onclick="addTournament()">Aggiungi</button>
    <button class="btn" onclick="closeModal()">Chiudi</button>
  </div>
</div>

<!-- MODAL PALMARES -->
<div id="palmaresModal" class="modal">
  <div class="modal-content">
    <div class="modal-header" id="palmaresTitle"></div>
    <div id="palmaresBody"></div><br>
    <button class="btn" onclick="closePalmares()">Chiudi</button>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBqkJaCnZ6Hzm7ytyoj3_dKeZ0kuNbJXbI",
  authDomain:"fantatennis-ecd35.firebaseapp.com",
  projectId:"fantatennis-ecd35"
});
const db=firebase.firestore();

const players=[
 'Gennaro','Mirko','Federico','Ciro','Damiano',
 'Carlo','Francesco','Friarello','Giuseppe','Donatello'
];

let tournaments=[];

function render(){
  renderHead();renderBody();renderStats();
}

function renderHead(){
  tablehead.innerHTML='<tr><th>TORNEO</th>'+
    players.map(p=>`<th>${p}</th>`).join('')+'</tr>';
}

function renderBody(){
  tablebody.innerHTML='';
  tournaments.forEach((t,i)=>{
    const row=document.createElement('tr');
    row.innerHTML='<td>'+t.name+'</td>'+
      players.map((_,j)=>
        `<td><input value="${t.scores[j]||''}"
         onchange="updateScore(${i},${j},this.value)"></td>`).join('');
    tablebody.appendChild(row);

    const vals=players.map((_,j)=>+t.scores[j]||0);
    const max=Math.max(...vals);
    row.querySelectorAll('input').forEach((inp,k)=>{
      inp.style.color=vals[k]===max && max>0?'red':'black';
    });
  });

  const tot=document.createElement('tr');
  tot.className='total-row';
  tot.innerHTML='<td>TOTALE</td>'+
    players.map((_,j)=>`<td>${getTotal(j)}</td>`).join('');
  tablebody.appendChild(tot);
}

function renderStats(){
  statsbody.innerHTML='';
  players.forEach((p,i)=>{
    let w=0,s=0,t=0;
    tournaments.forEach(tr=>{
      const arr=players.map((_,j)=>+tr.scores[j]||0).sort((a,b)=>b-a);
      const v=+tr.scores[i]||0;
      if(v===arr[0]&&v>0)w++;
      else if(v===arr[1]&&v>0)s++;
      else if(v===arr[2]&&v>0)t++;
    });
    statsbody.innerHTML+=
      `<tr>
        <td class="stats-player" onclick="openPalmares(${i})">${p}</td>
        <td>${w}</td><td>${s}</td><td>${t}</td>
      </tr>`;
  });
}

function openPalmares(i){
  let w=[],s=[],t=[];
  tournaments.forEach(tr=>{
    const vals=players.map((_,j)=>+tr.scores[j]||0);
    const ord=[...vals].sort((a,b)=>b-a);
    if(vals[i]===ord[0]&&ord[0]>0)w.push(tr.name);
    else if(vals[i]===ord[1]&&ord[1]>0)s.push(tr.name);
    else if(vals[i]===ord[2]&&ord[2]>0)t.push(tr.name);
  });
  palmaresTitle.textContent='üèÜ '+players[i];
  palmaresBody.innerHTML=
    `ü•á ${w.join(', ')||'‚Äî'}<br>
     ü•à ${s.join(', ')||'‚Äî'}<br>
     ü•â ${t.join(', ')||'‚Äî'}`;
  palmaresModal.style.display='block';
}
function closePalmares(){palmaresModal.style.display='none'}

function addTournament(){
  const n=tournamentname.value.trim();
  if(!n)return;
  tournaments.push({name:n,scores:{}});
  saveData();closeModal();
}
function updateScore(t,p,v){tournaments[t].scores[p]=v;render()}
function getTotal(j){
  return tournaments.reduce((s,t)=>s+(+t.scores[j]||0),0).toFixed(1)
}
function saveData(){db.collection('fantatennis').doc('shared').set({tournaments})}
function resetData(){if(confirm('Reset?')){tournaments=[];saveData();render()}}
function loadData(){
  db.collection('fantatennis').doc('shared')
    .onSnapshot(s=>{tournaments=s.data()?.tournaments||[];render()})
}

function openModal(){modal.style.display='block'}
function closeModal(){modal.style.display='none'}

document.addEventListener('DOMContentLoaded',loadData);
</script>
</body>
</html>
